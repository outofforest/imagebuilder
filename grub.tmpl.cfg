function load_video {
  insmod efi_gop
  insmod efi_uga
  insmod all_video
}

load_video
insmod gzio
insmod part_gpt
insmod ext2
insmod font
loadfont /grub2/fonts/font.pf2

insmod gfxterm

set gfxmode="1600x1200x32"
set gfxpayload=keep
terminal_output gfxterm
terminal gfxterm

set default=0
set timeout=10

{{ range . }}
menuentry "{{ .Name }} (NVIDIA.Display)" {
  linux /zfs/{{ .BuildID }}/vmlinuz root=zfs:tank/builds/{{ .BuildID }} bootfs.rollback zfs.force dev.turnoff gpu.nvidia.display vconsole.font=latarcyrheb-sun32 {{ range .Params }}{{ . }} {{ end }}
  initrd /zfs/{{ .BuildID }}/initramfs.img
}
menuentry "{{ .Name }} (NVIDIA.RND + AMD.Display)" {
  linux /zfs/{{ .BuildID }}/vmlinuz root=zfs:tank/builds/{{ .BuildID }} bootfs.rollback zfs.force dev.turnoff gpu.nvidia.rnd gpu.amd.display vconsole.font=latarcyrheb-sun32 {{ range .Params }}{{ . }} {{ end }}
  initrd /zfs/{{ .BuildID }}/initramfs.img
}
menuentry "{{ .Name }} (NVIDIA.RND)" {
  linux /zfs/{{ .BuildID }}/vmlinuz root=zfs:tank/builds/{{ .BuildID }} bootfs.rollback zfs.force dev.turnoff gpu.nvidia.rnd vconsole.font=latarcyrheb-sun32 {{ range .Params }}{{ . }} {{ end }}
  initrd /zfs/{{ .BuildID }}/initramfs.img
}
{{ end }}
